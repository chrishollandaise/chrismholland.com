---
// import { db, Contact } from "astro:db";
// import sendMail from "../util/sendMail";

if (Astro.request.method === "POST") {
    try {
        const data = await Astro.request.formData();

        const honeypot = data.get("phone");
        const name = data.get("name");
        const email = data.get("email");
        const message = data.get("message");
        const dateSent = new Date();
        const clientIP = Astro.clientAddress;

        if (honeypot) {
            return;
        }

        const submission = {
            name,
            email,
            message,
            dateSent,
            metadata: { ip: clientIP },
        };
        // TODO: add a honeypot, and a simple turing test.
        // Should also look into IP throttling, send one email twice a month
        //@ts-ignore
        // await db.insert(Contact).values(submission);
        // await sendMail(submission);
    } catch (error) {
        if (error instanceof Error) {
            console.error(error.message);
        }
    }
}
---

<section id="contact-me">
    <h2>Contact Me</h2>
    <form method="POST">
        <label>
            Name:
            <input
                type="text"
                name="name"
                placeholder="T-800"
                maxlength="50"
                required
            />
        </label>
        <label>
            <!-- RFC 5321, email address max length is 320 characters -->
            Email:
            <input
                type="email"
                name="email"
                maxlength="320"
                placeholder="terminate@skynet.com"
                required
            />
        </label>
        <label class="hmm">
            Phone Number <input
                name="phone"
                type="tel"
                placeholder="555-2368"
                pattern="[+]{1}[0-9]{11,14}"
            />
        </label>
    </form>
    <label>
        Message:
        <textarea
            name="message"
            cols="50"
            maxlength="1250"
            placeholder="You are terminated."
            required></textarea>
    </label>
    <br />
    <button>Submit</button>
</section>
